name: Python Playwright Tests
on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch: #manual runs
jobs:
  test:
    # Set a timeout in case tests hang
    timeout-minutes: 15
    # Use a fresh Ubuntu runner machine
    runs-on: ubuntu-latest

    # üö® ENVIRONMENT VARIABLES BLOCK
    env:
      # Non-sensitive configuration data
      TABLE_URL: https://docs.google.com/spreadsheets/d/11qRH9xUuglOTIZa7JnWTVBYuGMT32ZhFuJ5_xypApGM
      TABLE_NAME: 'WPPOOL Assignment Table'
      TABLE_DESCRIPTION: 'This table is created from google sheet to perform automation test on WPPOOL flextable plugin'

      # Need to create these secrets in repository settings:
      ADMIN_USERNAME: ${{ secrets.ADMIN_USERNAME }}
      ADMIN_PASSWORD: ${{ secrets.ADMIN_PASSWORD }}
      BASE_URL: ${{ secrets.ADMIN_PASSWORD }}

    steps:
    - name: üîë Checkout repository
      uses: actions/checkout@v4

    - name: üíª Set up Python
      # A stable Python version
      uses: actions/setup-python@v5
      with:
        python-version: '3.x'

    - name: üîß Install Python Dependencies
      # Have a requirements.txt file (or similar)
      run: |
        python -m pip install --upgrade pip
        # Install the playwright Pytest plugin and other dependencies
        pip install -r requirements.txt 
        # pip install pytest-playwright

    - name: üåê Install Playwright Browsers
      run: python -m playwright install --with-deps

    - name: ‚ñ∂Ô∏è Run Playwright tests with Pytest
      # runs all test files following the 'tests/' structure
      # All environment variables defined in the 'env' block are now available to Pytest
      run: pytest --tracing=retain-on-failure --html=playwright-report/index.html --self-contained-html

    - name: ‚¨ÜÔ∏è Upload Test Report (Artifact)
      # Upload the HTML report as an artifact to download and view later
      uses: actions/upload-artifact@v4
      if: ${{ always() }} # Always run this step, even if tests fail
      with:
        name: playwright-report
        path: playwright-report/
        retention-days: 30